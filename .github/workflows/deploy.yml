name: Deploy
on:
  workflow_dispatch:
    inputs:
      environment:
        type: choice
        description: "Select the environment to deploy to"
        required: true
        default: "staging"
        options:
          - staging
          - production

env:
  NODE_VERSION: 22
  FLYCTL_VERSION: 0.3.95

jobs:
  version:
    name: "Generate version"
    uses: felixmokross/webplatform/.github/workflows/export.version.yml@main

  deploy:
    name: Deploy
    if: github.event_name != 'pull_request'
    needs:
      - version
    uses: ./.github/workflows/deploy-version.yml
    with:
      version_with_sha: ${{ needs.version.outputs.version_with_sha }}
      sha: ${{ needs.version.outputs.sha }}
      environment: prod
    secrets: inherit
